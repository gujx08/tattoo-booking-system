<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stripeé“¾æ¥è°ƒè¯• - Patch Tattoo Therapy</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .debug-container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .debug-section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 5px; }
        .debug-button { padding: 12px 24px; margin: 10px 5px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 14px; }
        .debug-button:hover { background: #0056b3; }
        .success-button { background: #28a745; }
        .success-button:hover { background: #1e7e34; }
        .warning-button { background: #ffc107; color: #212529; }
        .warning-button:hover { background: #e0a800; }
        .danger-button { background: #dc3545; }
        .danger-button:hover { background: #c82333; }
        .info-box { background: #d1ecf1; border: 1px solid #bee5eb; padding: 15px; border-radius: 5px; margin: 15px 0; }
        .code-block { background: #f8f9fa; padding: 10px; border-radius: 3px; font-family: monospace; font-size: 12px; margin: 10px 0; }
        .status-success { color: #28a745; font-weight: bold; }
        .status-error { color: #dc3545; font-weight: bold; }
        .status-warning { color: #ffc107; font-weight: bold; }
        .link-display { word-break: break-all; }
    </style>
</head>
<body>
    <div class="debug-container">
        <h1>ğŸ”§ Stripeé“¾æ¥è°ƒè¯•å·¥å…·</h1>
        
        <div class="info-box">
            <h3>ğŸ“‹ è°ƒè¯•ç›®æ ‡</h3>
            <p>æ£€æŸ¥Stripe Payment Linksé…ç½®ï¼Œæ‰¾å‡º"live mode"é”™è¯¯çš„åŸå› ã€‚</p>
        </div>

        <div class="debug-section">
            <h3>ğŸŒ ç¯å¢ƒæ£€æµ‹</h3>
            <div id="environmentInfo">
                <p>æ­£åœ¨æ£€æµ‹ç¯å¢ƒä¿¡æ¯...</p>
            </div>
        </div>

        <div class="debug-section">
            <h3>ğŸ”— é“¾æ¥æµ‹è¯•</h3>
            <button class="debug-button" onclick="testAllLinks()">
                ğŸ§ª æµ‹è¯•æ‰€æœ‰Payment Links
            </button>
            
            <button class="debug-button" onclick="testSpecificArtist('jing')">
                ğŸ’³ æµ‹è¯•Jing ($300)
            </button>
            
            <button class="debug-button" onclick="testSpecificArtist('jasmine')">
                ğŸ’³ æµ‹è¯•Jasmine ($100)
            </button>
            
            <button class="debug-button" onclick="testSpecificArtist('maili')">
                ğŸ’³ æµ‹è¯•Maili ($50)
            </button>
        </div>

        <div class="debug-section">
            <h3>ğŸ“Š æµ‹è¯•ç»“æœ</h3>
            <div id="testResults">
                <p>æµ‹è¯•ç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º...</p>
            </div>
        </div>

        <div class="debug-section">
            <h3>ğŸ” é“¾æ¥åˆ†æ</h3>
            <div id="linkAnalysis">
                <p>é“¾æ¥åˆ†æç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º...</p>
            </div>
        </div>

        <div class="debug-section">
            <h3>ğŸ› ï¸ ä¿®å¤å»ºè®®</h3>
            <div id="fixSuggestions">
                <p>ä¿®å¤å»ºè®®å°†åœ¨è¿™é‡Œæ˜¾ç¤º...</p>
            </div>
        </div>
    </div>

    <script>
        // æ¨¡æ‹ŸStripeé…ç½®
        const FORCE_TEST_MODE = true;
        
        const STRIPE_PAYMENT_LINKS = {
            'jing': 'https://buy.stripe.com/00w6oHgLY6Zf5WW45Gfw400',
            'rachel': 'https://buy.stripe.com/3cIeVd8fsabr0CC31Cfw401',
            'jasmine': 'https://buy.stripe.com/3cIeVd8fsabr0CC31Cfw401',
            'lauren': 'https://buy.stripe.com/3cIeVd8fsabr0CC31Cfw401',
            'annika': 'https://buy.stripe.com/3cIeVd8fsabr0CC31Cfw401',
            'maili': 'https://buy.stripe.com/00w5kD9jwerH9988lWfw402',
            'keani': 'https://buy.stripe.com/00w5kD9jwerH9988lWfw402'
        };

        const STRIPE_TEST_PAYMENT_LINKS = {
            'jing': 'https://buy.stripe.com/test_00w6oHgLY6Zf5WW45Gfw400',
            'rachel': 'https://buy.stripe.com/test_3cIeVd8fsabr0CC31Cfw401',
            'jasmine': 'https://buy.stripe.com/test_3cIeVd8fsabr0CC31Cfw401',
            'lauren': 'https://buy.stripe.com/test_3cIeVd8fsabr0CC31Cfw401',
            'annika': 'https://buy.stripe.com/test_3cIeVd8fsabr0CC31Cfw401',
            'maili': 'https://buy.stripe.com/test_00w5kD9jwerH9988lWfw402',
            'keani': 'https://buy.stripe.com/test_00w5kD9jwerH9988lWfw402'
        };

        function log(message, type = 'info') {
            const resultsElement = document.getElementById('testResults');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${type.toUpperCase()}: ${message}`;
            resultsElement.innerHTML += logEntry + '<br>';
            console.log(logEntry);
        }

        function updateEnvironmentInfo() {
            const envElement = document.getElementById('environmentInfo');
            const info = {
                hostname: window.location.hostname,
                protocol: window.location.protocol,
                port: window.location.port,
                href: window.location.href,
                isLocalhost: window.location.hostname === 'localhost' || 
                             window.location.hostname.includes('127.0.0.1'),
                forceTestMode: FORCE_TEST_MODE
            };
            
            const isTestMode = FORCE_TEST_MODE || info.isLocalhost;
            
            envElement.innerHTML = `
                <div class="code-block">
                    <strong>ç¯å¢ƒä¿¡æ¯:</strong><br>
                    Hostname: ${info.hostname}<br>
                    Protocol: ${info.protocol}<br>
                    Port: ${info.port || 'default'}<br>
                    Full URL: ${info.href}<br>
                    Is Localhost: ${info.isLocalhost ? 'âœ… æ˜¯' : 'âŒ å¦'}<br>
                    Force Test Mode: ${info.forceTestMode ? 'âœ… æ˜¯' : 'âŒ å¦'}<br>
                    <strong>æœ€ç»ˆæ¨¡å¼: ${isTestMode ? 'ğŸ§ª æµ‹è¯•æ¨¡å¼' : 'ğŸš€ ç”Ÿäº§æ¨¡å¼'}</strong>
                </div>
            `;
        }

        function getStripePaymentLink(artistId) {
            const isTestMode = FORCE_TEST_MODE || 
                               window.location.hostname === 'localhost' || 
                               window.location.hostname.includes('127.0.0.1') || 
                               window.location.hostname.includes('localhost');
            
            console.log('ğŸ” Stripeç¯å¢ƒæ£€æµ‹:', {
                hostname: window.location.hostname,
                isTestMode: isTestMode,
                forceTestMode: FORCE_TEST_MODE,
                artistId: artistId
            });
            
            if (isTestMode) {
                const testLink = STRIPE_TEST_PAYMENT_LINKS[artistId] || STRIPE_TEST_PAYMENT_LINKS.rachel;
                console.log('ğŸ§ª ä½¿ç”¨æµ‹è¯•ç¯å¢ƒé“¾æ¥:', testLink);
                return testLink;
            } else {
                const prodLink = STRIPE_PAYMENT_LINKS[artistId] || STRIPE_PAYMENT_LINKS.rachel;
                console.log('ğŸš€ ä½¿ç”¨ç”Ÿäº§ç¯å¢ƒé“¾æ¥:', prodLink);
                return prodLink;
            }
        }

        function testAllLinks() {
            log('ğŸ§ª å¼€å§‹æµ‹è¯•æ‰€æœ‰Payment Links...');
            
            const artists = ['jing', 'jasmine', 'maili'];
            
            artists.forEach(artist => {
                const link = getStripePaymentLink(artist);
                const isTestLink = link.includes('/test_');
                
                log(`${artist}: ${isTestLink ? 'âœ… æµ‹è¯•é“¾æ¥' : 'âŒ ç”Ÿäº§é“¾æ¥'} - ${link}`, 
                    isTestLink ? 'success' : 'error');
            });
        }

        function testSpecificArtist(artistId) {
            log(`ğŸ§ª æµ‹è¯•è‰ºæœ¯å®¶ ${artistId} çš„Payment Link...`);
            
            const link = getStripePaymentLink(artistId);
            const isTestLink = link.includes('/test_');
            
            log(`è‰ºæœ¯å®¶: ${artistId}`, 'info');
            log(`é“¾æ¥: ${link}`, 'info');
            log(`ç±»å‹: ${isTestLink ? 'æµ‹è¯•é“¾æ¥' : 'ç”Ÿäº§é“¾æ¥'}`, isTestLink ? 'success' : 'error');
            
            // åˆ†æé“¾æ¥
            analyzeLink(link, artistId);
        }

        function analyzeLink(link, artistId) {
            log('ğŸ” åˆ†æé“¾æ¥...');
            
            const analysisElement = document.getElementById('linkAnalysis');
            let analysis = `<strong>ğŸ” é“¾æ¥åˆ†æç»“æœ:</strong><br><br>`;
            
            // æ£€æŸ¥æ˜¯å¦æ˜¯æµ‹è¯•é“¾æ¥
            const isTestLink = link.includes('/test_');
            analysis += `é“¾æ¥ç±»å‹: ${isTestLink ? 'âœ… æµ‹è¯•é“¾æ¥' : 'âŒ ç”Ÿäº§é“¾æ¥'}<br>`;
            
            // æ£€æŸ¥é“¾æ¥æ ¼å¼
            const hasStripeDomain = link.includes('buy.stripe.com');
            analysis += `StripeåŸŸå: ${hasStripeDomain ? 'âœ… æ­£ç¡®' : 'âŒ é”™è¯¯'}<br>`;
            
            // æ£€æŸ¥è‰ºæœ¯å®¶ID
            const expectedAmount = artistId === 'jing' ? '$300' : 
                                  artistId === 'maili' ? '$50' : '$100';
            analysis += `é¢„æœŸé‡‘é¢: ${expectedAmount}<br>`;
            
            // æ£€æŸ¥é“¾æ¥ID
            const linkId = link.split('/').pop();
            analysis += `é“¾æ¥ID: ${linkId}<br>`;
            
            // å»ºè®®
            if (!isTestLink) {
                analysis += `<br><strong>âš ï¸ é—®é¢˜:</strong> ä½¿ç”¨äº†ç”Ÿäº§é“¾æ¥ï¼Œä½†åº”è¯¥ä½¿ç”¨æµ‹è¯•é“¾æ¥<br>`;
                analysis += `<strong>ğŸ”§ è§£å†³æ–¹æ¡ˆ:</strong> æ£€æŸ¥FORCE_TEST_MODEè®¾ç½®æˆ–ç¯å¢ƒæ£€æµ‹é€»è¾‘<br>`;
            } else {
                analysis += `<br><strong>âœ… çŠ¶æ€:</strong> é“¾æ¥é…ç½®æ­£ç¡®<br>`;
            }
            
            analysisElement.innerHTML = analysis;
        }

        function generateFixSuggestions() {
            log('ğŸ› ï¸ ç”Ÿæˆä¿®å¤å»ºè®®...');
            
            const suggestionsElement = document.getElementById('fixSuggestions');
            let suggestions = '<strong>ğŸ› ï¸ ä¿®å¤å»ºè®®:</strong><br><br>';
            
            // æ£€æŸ¥å½“å‰é…ç½®
            const isTestMode = FORCE_TEST_MODE || 
                               window.location.hostname === 'localhost' || 
                               window.location.hostname.includes('127.0.0.1');
            
            if (!isTestMode) {
                suggestions += '<strong>âŒ é—®é¢˜:</strong> å½“å‰ä¸åœ¨æµ‹è¯•æ¨¡å¼<br>';
                suggestions += '<strong>ğŸ”§ è§£å†³æ–¹æ¡ˆ:</strong><br>';
                suggestions += '1. è®¾ç½® FORCE_TEST_MODE = true<br>';
                suggestions += '2. æˆ–åœ¨localhostç¯å¢ƒä¸‹æµ‹è¯•<br><br>';
            }
            
            suggestions += '<strong>ğŸ“‹ æ£€æŸ¥æ¸…å•:</strong><br>';
            suggestions += '1. ç¡®è®¤FORCE_TEST_MODE = true<br>';
            suggestions += '2. ç¡®è®¤ä½¿ç”¨localhostç¯å¢ƒ<br>';
            suggestions += '3. ç¡®è®¤æµ‹è¯•Payment Linksæ­£ç¡®é…ç½®<br>';
            suggestions += '4. ç¡®è®¤Stripe Dashboardä¸­çš„é“¾æ¥æ˜¯æµ‹è¯•æ¨¡å¼<br><br>';
            
            suggestions += '<strong>ğŸ¯ æµ‹è¯•æ­¥éª¤:</strong><br>';
            suggestions += '1. åœ¨localhostç¯å¢ƒä¸‹æµ‹è¯•<br>';
            suggestions += '2. ä½¿ç”¨æµ‹è¯•å¡å·: 4242 4242 4242 4242<br>';
            suggestions += '3. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°çš„ç¯å¢ƒæ£€æµ‹æ—¥å¿—<br>';
            
            suggestionsElement.innerHTML = suggestions;
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡Œ
        window.onload = function() {
            log('ğŸš€ Stripeé“¾æ¥è°ƒè¯•å·¥å…·åŠ è½½å®Œæˆ');
            updateEnvironmentInfo();
            generateFixSuggestions();
        };
    </script>
</body>
</html>
