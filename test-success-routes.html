<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Successé¡µé¢è·¯ç”±æµ‹è¯• - Patch Tattoo Therapy</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .test-container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .test-section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 5px; }
        .test-button { padding: 12px 24px; margin: 10px 5px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 14px; }
        .test-button:hover { background: #0056b3; }
        .success-button { background: #28a745; }
        .success-button:hover { background: #1e7e34; }
        .warning-button { background: #ffc107; color: #212529; }
        .warning-button:hover { background: #e0a800; }
        .info-box { background: #d1ecf1; border: 1px solid #bee5eb; padding: 15px; border-radius: 5px; margin: 15px 0; }
        .code-block { background: #f8f9fa; padding: 10px; border-radius: 3px; font-family: monospace; font-size: 12px; margin: 10px 0; }
        .status-success { color: #28a745; font-weight: bold; }
        .status-error { color: #dc3545; font-weight: bold; }
        .status-warning { color: #ffc107; font-weight: bold; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ”§ Successé¡µé¢è·¯ç”±æµ‹è¯•</h1>
        
        <div class="info-box">
            <h3>ğŸ“‹ æµ‹è¯•ç›®æ ‡</h3>
            <p>éªŒè¯Successé¡µé¢å¯ä»¥é€šè¿‡URLç›´æ¥è®¿é—®ï¼Œå¹¶ä¸”èƒ½å¤Ÿæ­£ç¡®æ˜¾ç¤ºé¢„è®¢æ•°æ®ã€‚</p>
        </div>

        <div class="test-section">
            <h3>ğŸ¯ è·¯ç”±æµ‹è¯•</h3>
            <p>æµ‹è¯•ä¸åŒçš„è·¯ç”±è®¿é—®æ–¹å¼ï¼š</p>
            
            <button class="test-button" onclick="testDirectSuccessAccess()">
                ğŸ”— ç›´æ¥è®¿é—® /success
            </button>
            
            <button class="test-button" onclick="testWithMockData()">
                ğŸ“ æ¨¡æ‹Ÿé¢„è®¢æ•°æ®åè®¿é—®
            </button>
            
            <button class="test-button" onclick="testStripeRedirect()">
                ğŸ’³ æ¨¡æ‹ŸStripeæ”¯ä»˜è·³è½¬
            </button>
            
            <button class="test-button warning-button" onclick="clearLocalStorage()">
                ğŸ—‘ï¸ æ¸…é™¤localStorageæ•°æ®
            </button>
        </div>

        <div class="test-section">
            <h3>ğŸ“Š å½“å‰çŠ¶æ€</h3>
            <div id="currentStatus">
                <p>æ­£åœ¨æ£€æŸ¥å½“å‰çŠ¶æ€...</p>
            </div>
        </div>

        <div class="test-section">
            <h3>ğŸ” è°ƒè¯•ä¿¡æ¯</h3>
            <div id="debugInfo">
                <p>è°ƒè¯•ä¿¡æ¯å°†åœ¨è¿™é‡Œæ˜¾ç¤º...</p>
            </div>
        </div>

        <div class="test-section">
            <h3>ğŸ“‹ æµ‹è¯•æ­¥éª¤</h3>
            <ol>
                <li><strong>æ¸…é™¤æ•°æ®</strong> - ç‚¹å‡»"æ¸…é™¤localStorageæ•°æ®"æŒ‰é’®</li>
                <li><strong>ç›´æ¥è®¿é—®</strong> - ç‚¹å‡»"ç›´æ¥è®¿é—® /success"æµ‹è¯•æ— æ•°æ®æƒ…å†µ</li>
                <li><strong>æ¨¡æ‹Ÿæ•°æ®</strong> - ç‚¹å‡»"æ¨¡æ‹Ÿé¢„è®¢æ•°æ®åè®¿é—®"æµ‹è¯•æœ‰æ•°æ®æƒ…å†µ</li>
                <li><strong>éªŒè¯åŠŸèƒ½</strong> - ç¡®è®¤Successé¡µé¢èƒ½æ­£ç¡®æ˜¾ç¤ºå’Œå‘é€é‚®ä»¶</li>
            </ol>
        </div>

        <div class="test-section">
            <h3>ğŸ¯ æœŸæœ›ç»“æœ</h3>
            <ul>
                <li>âœ… ç›´æ¥è®¿é—® `/success` æ˜¾ç¤ºé€šç”¨æˆåŠŸä¿¡æ¯</li>
                <li>âœ… æœ‰é¢„è®¢æ•°æ®æ—¶æ˜¾ç¤ºå®Œæ•´çš„é¢„è®¢æ‘˜è¦</li>
                <li>âœ… é‚®ä»¶å‘é€åŠŸèƒ½æ­£å¸¸å·¥ä½œ</li>
                <li>âœ… "Book Another Appointment" æŒ‰é’®æ­£ç¡®è·³è½¬</li>
            </ul>
        </div>
    </div>

    <script>
        function log(message, type = 'info') {
            const debugElement = document.getElementById('debugInfo');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${type.toUpperCase()}: ${message}`;
            debugElement.innerHTML += logEntry + '<br>';
            console.log(logEntry);
        }

        function updateStatus(message, type = 'info') {
            const statusElement = document.getElementById('currentStatus');
            const className = type === 'success' ? 'status-success' : 
                             type === 'error' ? 'status-error' : 
                             type === 'warning' ? 'status-warning' : '';
            
            statusElement.innerHTML = `<div class="${className}">${message}</div>`;
        }

        function checkCurrentStatus() {
            log('æ£€æŸ¥å½“å‰çŠ¶æ€...');
            
            const savedData = localStorage.getItem('patchTattooBooking');
            if (savedData) {
                try {
                    const bookingData = JSON.parse(savedData);
                    log('âœ… æ‰¾åˆ°ä¿å­˜çš„é¢„è®¢æ•°æ®', 'success');
                    log(`- å®¢æˆ·: ${bookingData.formData?.name || 'N/A'}`);
                    log(`- è‰ºæœ¯å®¶: ${bookingData.selectedArtist?.displayName || 'N/A'}`);
                    log(`- æŠ¼é‡‘: $${bookingData.depositAmount || 'N/A'}`);
                    
                    updateStatus('âœ… æ‰¾åˆ°é¢„è®¢æ•°æ®ï¼ŒSuccessé¡µé¢å°†æ˜¾ç¤ºå®Œæ•´ä¿¡æ¯', 'success');
                } catch (error) {
                    log('âŒ è§£ælocalStorageæ•°æ®å¤±è´¥: ' + error.message, 'error');
                    updateStatus('âŒ localStorageæ•°æ®æ ¼å¼é”™è¯¯', 'error');
                }
            } else {
                log('âš ï¸ æ²¡æœ‰æ‰¾åˆ°é¢„è®¢æ•°æ®', 'warning');
                updateStatus('âš ï¸ æ²¡æœ‰é¢„è®¢æ•°æ®ï¼ŒSuccessé¡µé¢å°†æ˜¾ç¤ºé€šç”¨ä¿¡æ¯', 'warning');
            }
        }

        function testDirectSuccessAccess() {
            log('ğŸ§ª æµ‹è¯•ç›´æ¥è®¿é—® /success...');
            
            // æ¸…é™¤localStorageç¡®ä¿æµ‹è¯•å¹²å‡€
            localStorage.removeItem('patchTattooBooking');
            log('ğŸ—‘ï¸ å·²æ¸…é™¤localStorageæ•°æ®');
            
            // è·³è½¬åˆ°successé¡µé¢
            window.location.href = '/success';
        }

        function testWithMockData() {
            log('ğŸ“ åˆ›å»ºæ¨¡æ‹Ÿé¢„è®¢æ•°æ®...');
            
            const mockBookingData = {
                formData: {
                    artistId: 'jing',
                    name: 'Test User',
                    email: 'test@example.com',
                    phone: '(555) 123-4567',
                    tattooIdea: 'A beautiful dragon tattoo',
                    referenceImages: ['ref1.jpg', 'ref2.jpg'],
                    additionalNotes: 'I want it colorful',
                    instagramReference: '@testuser',
                    backgroundStory: 'This represents my journey',
                    placement: 'Full sleeve on left arm',
                    bodyPhotos: ['photo1.jpg'],
                    placementCertainty: 'Very certain',
                    openToSuggestions: 'Yes, open to suggestions',
                    colorPreference: 'I like vibrant colors',
                    skinTone: 'Medium-Light',
                    isFirstTattoo: 'I have 1-2 small tattoos',
                    additionalInfo: 'I have sensitive skin',
                    needsConsultation: true
                },
                selectedArtist: {
                    id: 'jing',
                    name: 'Jingxi Gu',
                    displayName: 'Jing',
                    category: 'Lead Artist',
                    deposit: 300
                },
                consultationChoice: true,
                timestamp: new Date().toISOString(),
                depositAmount: 300,
                status: 'PENDING_PAYMENT'
            };

            // ä¿å­˜åˆ°localStorage
            localStorage.setItem('patchTattooBooking', JSON.stringify(mockBookingData));
            log('âœ… æ¨¡æ‹Ÿæ•°æ®å·²ä¿å­˜åˆ°localStorage', 'success');
            
            // è·³è½¬åˆ°successé¡µé¢
            setTimeout(() => {
                log('ğŸ”— è·³è½¬åˆ° /success é¡µé¢...');
                window.location.href = '/success';
            }, 500);
        }

        function testStripeRedirect() {
            log('ğŸ’³ æ¨¡æ‹ŸStripeæ”¯ä»˜æˆåŠŸè·³è½¬...');
            
            // åˆ›å»ºæ¨¡æ‹Ÿæ•°æ®ï¼ˆæ¨¡æ‹Ÿæ”¯ä»˜å®Œæˆåçš„çŠ¶æ€ï¼‰
            const mockBookingData = {
                formData: {
                    artistId: 'jing',
                    name: 'Stripe Test User',
                    email: 'stripe-test@example.com',
                    phone: '(555) 987-6543',
                    tattooIdea: 'Stripe payment test tattoo',
                    placement: 'Right forearm',
                    colorPreference: 'Black and gray',
                    needsConsultation: false
                },
                selectedArtist: {
                    id: 'jing',
                    name: 'Jingxi Gu',
                    displayName: 'Jing',
                    category: 'Lead Artist',
                    deposit: 300
                },
                consultationChoice: false,
                timestamp: new Date().toISOString(),
                depositAmount: 300,
                status: 'PAYMENT_COMPLETED'
            };

            // ä¿å­˜åˆ°localStorage
            localStorage.setItem('patchTattooBooking', JSON.stringify(mockBookingData));
            log('âœ… Stripeæ”¯ä»˜æ¨¡æ‹Ÿæ•°æ®å·²ä¿å­˜', 'success');
            
            // æ¨¡æ‹ŸURLå‚æ•°ï¼ˆStripeå¯èƒ½æ·»åŠ çš„å‚æ•°ï¼‰
            const successUrl = '/success?payment_intent=pi_test_123&redirect_status=succeeded';
            log(`ğŸ”— è·³è½¬åˆ°: ${successUrl}`);
            
            setTimeout(() => {
                window.location.href = successUrl;
            }, 500);
        }

        function clearLocalStorage() {
            log('ğŸ—‘ï¸ æ¸…é™¤localStorageæ•°æ®...');
            localStorage.removeItem('patchTattooBooking');
            log('âœ… localStorageæ•°æ®å·²æ¸…é™¤', 'success');
            updateStatus('âœ… localStorageæ•°æ®å·²æ¸…é™¤', 'success');
            
            // åˆ·æ–°çŠ¶æ€æ˜¾ç¤º
            setTimeout(checkCurrentStatus, 100);
        }

        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥çŠ¶æ€
        window.onload = function() {
            log('ğŸš€ è·¯ç”±æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ');
            checkCurrentStatus();
        };
    </script>
</body>
</html>
