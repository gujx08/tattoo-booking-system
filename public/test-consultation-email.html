<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Consultation Email Variables</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .result { background: #f5f5f5; padding: 10px; margin: 10px 0; border-radius: 3px; }
        button { padding: 10px 15px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 3px; cursor: pointer; }
        input, textarea { padding: 8px; margin: 5px; border: 1px solid #ddd; border-radius: 3px; width: 100%; }
        .form-group { margin: 10px 0; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        .debug-info { background: #fff3cd; border: 1px solid #ffeaa7; padding: 10px; margin: 10px 0; border-radius: 3px; }
    </style>
</head>
<body>
    <h1>ğŸ§ª æµ‹è¯•å’¨è¯¢æ—¶é—´é‚®ä»¶å˜é‡</h1>
    
    <div class="test-section">
        <h3>æ¨¡æ‹Ÿé¢„è®¢æ•°æ®</h3>
        
        <div class="form-group">
            <label>å®¢æˆ·å§“å:</label>
            <input type="text" id="customerName" value="Test User" placeholder="è¾“å…¥å®¢æˆ·å§“å">
        </div>
        
        <div class="form-group">
            <label>å®¢æˆ·é‚®ç®±:</label>
            <input type="email" id="customerEmail" value="test@example.com" placeholder="è¾“å…¥å®¢æˆ·é‚®ç®±">
        </div>
        
        <div class="form-group">
            <label>é€‰ä¸­çš„è‰ºæœ¯å®¶:</label>
            <select id="selectedArtist">
                <option value="jing">Jing</option>
                <option value="rachel">Rachel</option>
                <option value="jasmine">Jasmine</option>
                <option value="lauren">Lauren</option>
                <option value="annika">Annika</option>
            </select>
        </div>
        
        <div class="form-group">
            <label>æ˜¯å¦éœ€è¦å’¨è¯¢:</label>
            <select id="needsConsultation" onchange="toggleConsultationFields()">
                <option value="false">No consultation needed</option>
                <option value="true">Yes, I need consultation</option>
            </select>
        </div>
        
        <div id="consultationFields" style="display: none;">
            <div class="form-group">
                <label>å’¨è¯¢æ—¥æœŸ:</label>
                <input type="text" id="consultationDate" value="Wednesday, January 15, 2025" placeholder="å’¨è¯¢æ—¥æœŸ">
            </div>
            
            <div class="form-group">
                <label>å’¨è¯¢æ—¶é—´:</label>
                <input type="text" id="consultationTime" value="8:00 PM - 8:30 PM" placeholder="å’¨è¯¢æ—¶é—´">
            </div>
        </div>
        
        <div class="form-group">
            <label>çº¹èº«æƒ³æ³•:</label>
            <textarea id="tattooIdea" rows="3" placeholder="æè¿°çº¹èº«æƒ³æ³•">I want a small dragon tattoo on my forearm</textarea>
        </div>
        
        <div class="form-group">
            <label>ä½ç½®:</label>
            <input type="text" id="placement" value="Forearm" placeholder="çº¹èº«ä½ç½®">
        </div>
        
        <div class="form-group">
            <label>é¢œè‰²åå¥½:</label>
            <input type="text" id="colorPreference" value="Black and grey" placeholder="é¢œè‰²åå¥½">
        </div>
        
        <button onclick="testConsultationEmail()">æµ‹è¯•å’¨è¯¢æ—¶é—´é‚®ä»¶å˜é‡</button>
        <div id="testResult" class="result"></div>
    </div>

    <script>
        function toggleConsultationFields() {
            const needsConsultation = document.getElementById('needsConsultation').value;
            const consultationFields = document.getElementById('consultationFields');
            
            if (needsConsultation === 'true') {
                consultationFields.style.display = 'block';
            } else {
                consultationFields.style.display = 'none';
            }
        }

        function testConsultationEmail() {
            const result = document.getElementById('testResult');
            result.innerHTML = '<p>ğŸ”„ æ­£åœ¨æµ‹è¯•å’¨è¯¢æ—¶é—´é‚®ä»¶å˜é‡...</p>';

            // æ”¶é›†è¡¨å•æ•°æ®
            const needsConsultation = document.getElementById('needsConsultation').value === 'true';
            const consultationDate = document.getElementById('consultationDate').value;
            const consultationTime = document.getElementById('consultationTime').value;

            // æ¨¡æ‹ŸPaymentPageçš„æ•°æ®ç»“æ„
            const completeBookingData = {
                formData: {
                    name: document.getElementById('customerName').value,
                    email: document.getElementById('customerEmail').value,
                    needsConsultation: needsConsultation,
                    consultationDate: consultationDate,
                    consultationTime: consultationTime,
                    tattooIdea: document.getElementById('tattooIdea').value,
                    placement: document.getElementById('placement').value,
                    colorPreference: document.getElementById('colorPreference').value
                },
                selectedArtist: {
                    id: document.getElementById('selectedArtist').value,
                    name: document.getElementById('selectedArtist').options[document.getElementById('selectedArtist').selectedIndex].text
                },
                consultationChoice: needsConsultation,
                timestamp: new Date().toISOString(),
                depositAmount: 100,
                status: 'PENDING_PAYMENT'
            };

            // æ¨¡æ‹Ÿé‚®ä»¶æœåŠ¡ä¸­çš„consultation_detailsé€»è¾‘
            const consultation_details = (() => {
                // æ£€æŸ¥æ˜¯å¦éœ€è¦å’¨è¯¢ï¼ˆæ”¯æŒå¤šç§å­—æ®µåï¼‰
                const needsConsultation = completeBookingData.consultationChoice || 
                                         completeBookingData.formData?.needsConsultation || 
                                         false;
                
                if (needsConsultation) {
                    // éœ€è¦å’¨è¯¢ï¼Œæ˜¾ç¤ºå…·ä½“æ—¶é—´
                    const consultationDate = completeBookingData.formData?.consultationDate || '';
                    const consultationTime = completeBookingData.formData?.consultationTime || '';
                    
                    if (consultationDate && consultationTime) {
                        return `Yes - ${consultationDate} at ${consultationTime}`;
                    } else {
                        return 'Yes - consultation time to be scheduled';
                    }
                } else {
                    // ä¸éœ€è¦å’¨è¯¢
                    return 'No consultation needed';
                }
            })();

            // å‡†å¤‡é‚®ä»¶æ¨¡æ¿å‚æ•°
            const templateParams = {
                // å®¢æˆ·åŸºæœ¬ä¿¡æ¯
                customer_name: completeBookingData.formData?.name || '',
                customer_email: completeBookingData.formData?.email || '',
                customer_phone: completeBookingData.formData?.phone || '',
                
                // çº¹èº«å¸ˆä¿¡æ¯
                selected_artist: completeBookingData.selectedArtist?.name || '',
                artist_id: completeBookingData.selectedArtist?.id || '',
                
                // çº¹èº«è¯¦æƒ…
                tattoo_idea: completeBookingData.formData?.tattooIdea || '',
                size_placement: completeBookingData.formData?.placement || '',
                color_preference: completeBookingData.formData?.colorPreference || '',
                
                // å’¨è¯¢ä¿¡æ¯
                consultation_details: consultation_details,
                deposit_amount: completeBookingData.depositAmount || 0,
                
                // å…¶ä»–å­—æ®µ
                instagram_link: '',
                background_story: '',
                placement_certainty: '',
                body_assessment: '',
                skin_tone: '',
                tattoo_experience: '',
                additional_info: ''
            };

            // æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯
            let html = `
                <h4>ğŸ“§ é‚®ä»¶æ¨¡æ¿å‚æ•°æµ‹è¯•ç»“æœ:</h4>
                
                <div class="debug-info">
                    <h5>ğŸ” è°ƒè¯•ä¿¡æ¯:</h5>
                    <p><strong>needsConsultation:</strong> ${needsConsultation}</p>
                    <p><strong>consultationDate:</strong> "${consultationDate}"</p>
                    <p><strong>consultationTime:</strong> "${consultationTime}"</p>
                    <p><strong>consultationChoice:</strong> ${completeBookingData.consultationChoice}</p>
                </div>
                
                <h5>ğŸ“¨ é‚®ä»¶æ¨¡æ¿å˜é‡:</h5>
            `;

            // æ˜¾ç¤ºå…³é”®å˜é‡
            const keyVariables = [
                'customer_name',
                'selected_artist', 
                'consultation_details',
                'tattoo_idea',
                'size_placement',
                'color_preference',
                'deposit_amount'
            ];

            keyVariables.forEach(key => {
                html += `
                    <div style="margin: 10px 0; padding: 8px; background: white; border-left: 3px solid #007bff;">
                        <strong>${key}:</strong><br>
                        <code style="word-break: break-all;">${templateParams[key]}</code>
                    </div>
                `;
            });

            // æ˜¾ç¤ºå®Œæ•´çš„æ¨¡æ¿å‚æ•°
            html += `
                <h5>ğŸ“‹ å®Œæ•´æ¨¡æ¿å‚æ•°:</h5>
                <pre style="background: white; padding: 10px; border-radius: 3px; overflow-x: auto;">${JSON.stringify(templateParams, null, 2)}</pre>
            `;

            result.innerHTML = html;
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.onload = function() {
            toggleConsultationFields();
        };
    </script>
</body>
</html>
