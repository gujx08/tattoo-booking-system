<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”Ÿäº§ç¯å¢ƒè¯Šæ–­ - Patch Tattoo Therapy</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .debug-container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .debug-section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 5px; }
        .debug-button { padding: 12px 24px; margin: 10px 5px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 14px; }
        .debug-button:hover { background: #0056b3; }
        .success-button { background: #28a745; }
        .success-button:hover { background: #1e7e34; }
        .warning-button { background: #ffc107; color: #212529; }
        .warning-button:hover { background: #e0a800; }
        .danger-button { background: #dc3545; }
        .danger-button:hover { background: #c82333; }
        .info-box { background: #d1ecf1; border: 1px solid #bee5eb; padding: 15px; border-radius: 5px; margin: 15px 0; }
        .code-block { background: #f8f9fa; padding: 10px; border-radius: 3px; font-family: monospace; font-size: 12px; margin: 10px 0; }
        .status-success { color: #28a745; font-weight: bold; }
        .status-error { color: #dc3545; font-weight: bold; }
        .status-warning { color: #ffc107; font-weight: bold; }
    </style>
</head>
<body>
    <div class="debug-container">
        <h1>ğŸ”§ ç”Ÿäº§ç¯å¢ƒè¯Šæ–­å·¥å…·</h1>
        
        <div class="info-box">
            <h3>ğŸ“‹ è¯Šæ–­ç›®æ ‡</h3>
            <p>ä¸“é—¨è¯Šæ–­ç”Ÿäº§ç¯å¢ƒ <code>booking.patchtattootherapy.com</code> çš„é—®é¢˜ã€‚</p>
        </div>

        <div class="debug-section">
            <h3>ğŸŒ ç”Ÿäº§ç¯å¢ƒæ£€æµ‹</h3>
            <div id="productionInfo">
                <p>æ­£åœ¨æ£€æµ‹ç”Ÿäº§ç¯å¢ƒä¿¡æ¯...</p>
            </div>
        </div>

        <div class="debug-section">
            <h3>ğŸ”— è·¯ç”±æµ‹è¯•</h3>
            <button class="debug-button" onclick="testProductionRoutes()">
                ğŸ¯ æµ‹è¯•ç”Ÿäº§ç¯å¢ƒè·¯ç”±
            </button>
            
            <button class="debug-button" onclick="testSuccessPage()">
                âœ… æµ‹è¯•Successé¡µé¢
            </button>
            
            <button class="debug-button" onclick="testStripeConfig()">
                ğŸ’³ æµ‹è¯•Stripeé…ç½®
            </button>
            
            <button class="debug-button warning-button" onclick="checkNetlifyConfig()">
                ğŸŒ æ£€æŸ¥Netlifyé…ç½®
            </button>
        </div>

        <div class="debug-section">
            <h3>ğŸ“Š æµ‹è¯•ç»“æœ</h3>
            <div id="testResults">
                <p>æµ‹è¯•ç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º...</p>
            </div>
        </div>

        <div class="debug-section">
            <h3>ğŸ” ç½‘ç»œè¯·æ±‚åˆ†æ</h3>
            <button class="debug-button" onclick="analyzeNetworkRequests()">
                ğŸŒ åˆ†æç½‘ç»œè¯·æ±‚
            </button>
            <div id="networkAnalysis">
                <p>ç½‘ç»œåˆ†æç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º...</p>
            </div>
        </div>

        <div class="debug-section">
            <h3>ğŸ“‹ é—®é¢˜è¯Šæ–­</h3>
            <div id="diagnosis">
                <p>é—®é¢˜è¯Šæ–­ç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º...</p>
            </div>
        </div>

        <div class="debug-section">
            <h3>ğŸ› ï¸ ä¿®å¤å»ºè®®</h3>
            <div id="fixSuggestions">
                <p>ä¿®å¤å»ºè®®å°†åœ¨è¿™é‡Œæ˜¾ç¤º...</p>
            </div>
        </div>
    </div>

    <script>
        function log(message, type = 'info') {
            const resultsElement = document.getElementById('testResults');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${type.toUpperCase()}: ${message}`;
            resultsElement.innerHTML += logEntry + '<br>';
            console.log(logEntry);
        }

        function updateProductionInfo() {
            const infoElement = document.getElementById('productionInfo');
            const info = {
                hostname: window.location.hostname,
                protocol: window.location.protocol,
                port: window.location.port,
                pathname: window.location.pathname,
                href: window.location.href,
                userAgent: navigator.userAgent,
                timestamp: new Date().toISOString(),
                isProduction: window.location.hostname === 'booking.patchtattootherapy.com'
            };
            
            infoElement.innerHTML = `
                <div class="code-block">
                    <strong>ç”Ÿäº§ç¯å¢ƒä¿¡æ¯:</strong><br>
                    Hostname: ${info.hostname}<br>
                    Protocol: ${info.protocol}<br>
                    Port: ${info.port || 'default'}<br>
                    Pathname: ${info.pathname}<br>
                    Full URL: ${info.href}<br>
                    Is Production: ${info.isProduction ? 'âœ… æ˜¯' : 'âŒ å¦'}<br>
                    Timestamp: ${info.timestamp}
                </div>
            `;
        }

        function testProductionRoutes() {
            log('ğŸ¯ å¼€å§‹æµ‹è¯•ç”Ÿäº§ç¯å¢ƒè·¯ç”±...');
            
            const routes = ['/', '/success', '/booking-success', '/nonexistent'];
            
            routes.forEach(route => {
                fetch(route)
                    .then(response => {
                        const status = response.status;
                        const statusText = response.statusText;
                        const isSuccess = response.ok;
                        
                        log(`${route}: ${status} ${statusText}`, isSuccess ? 'success' : 'error');
                        
                        if (route === '/success' && status === 200) {
                            log('âœ… Successé¡µé¢è·¯ç”±æ­£å¸¸', 'success');
                        } else if (route === '/success' && status === 404) {
                            log('âŒ Successé¡µé¢è·¯ç”±å¤±è´¥ - 404é”™è¯¯', 'error');
                        }
                    })
                    .catch(error => {
                        log(`${route}: è¯·æ±‚å¤±è´¥ - ${error.message}`, 'error');
                    });
            });
        }

        function testSuccessPage() {
            log('âœ… æµ‹è¯•Successé¡µé¢åŠŸèƒ½...');
            
            // åˆ›å»ºæµ‹è¯•æ•°æ®
            const testData = {
                formData: {
                    name: 'Production Test User',
                    email: 'production-test@example.com',
                    tattooIdea: 'Production test tattoo'
                },
                selectedArtist: {
                    displayName: 'Jing',
                    name: 'Jingxi Gu'
                },
                depositAmount: 300,
                timestamp: new Date().toISOString()
            };
            
            // ä¿å­˜æµ‹è¯•æ•°æ®
            localStorage.setItem('patchTattooBooking', JSON.stringify(testData));
            log('âœ… æµ‹è¯•æ•°æ®å·²ä¿å­˜åˆ°localStorage', 'success');
            
            // æµ‹è¯•Successé¡µé¢è®¿é—®
            setTimeout(() => {
                log('ğŸ”— è·³è½¬åˆ° /success é¡µé¢...', 'warning');
                window.location.href = '/success';
            }, 1000);
        }

        function testStripeConfig() {
            log('ğŸ’³ æµ‹è¯•Stripeé…ç½®...');
            
            // æ¨¡æ‹ŸStripeé…ç½®æ£€æµ‹
            const isProduction = window.location.hostname === 'booking.patchtattootherapy.com';
            const isLocalhost = window.location.hostname === 'localhost' || 
                               window.location.hostname.includes('127.0.0.1');
            
            log(`ç¯å¢ƒæ£€æµ‹: ${isProduction ? 'ç”Ÿäº§ç¯å¢ƒ' : isLocalhost ? 'æœ¬åœ°ç¯å¢ƒ' : 'å…¶ä»–ç¯å¢ƒ'}`, 'info');
            
            // æµ‹è¯•Payment Links
            const testLinks = {
                'jing': 'https://buy.stripe.com/00w6oHgLY6Zf5WW45Gfw400',
                'jasmine': 'https://buy.stripe.com/3cIeVd8fsabr0CC31Cfw401',
                'maili': 'https://buy.stripe.com/00w5kD9jwerH9988lWfw402'
            };
            
            Object.entries(testLinks).forEach(([artist, link]) => {
                log(`æµ‹è¯• ${artist} çš„Payment Link: ${link}`, 'info');
                
                // æµ‹è¯•é“¾æ¥å¯è®¿é—®æ€§
                fetch(link, { method: 'HEAD', mode: 'no-cors' })
                    .then(() => {
                        log(`âœ… ${artist} Payment Link å¯è®¿é—®`, 'success');
                    })
                    .catch(() => {
                        log(`âš ï¸ ${artist} Payment Link å¯èƒ½æœ‰é—®é¢˜`, 'warning');
                    });
            });
        }

        function checkNetlifyConfig() {
            log('ğŸŒ æ£€æŸ¥Netlifyé…ç½®...');
            
            // æ£€æŸ¥_redirectsæ–‡ä»¶
            fetch('/_redirects')
                .then(response => {
                    if (response.ok) {
                        return response.text();
                    } else {
                        throw new Error('_redirectsæ–‡ä»¶ä¸å­˜åœ¨');
                    }
                })
                .then(content => {
                    log('âœ… _redirectsæ–‡ä»¶å­˜åœ¨', 'success');
                    log(`å†…å®¹: ${content.trim()}`, 'info');
                    
                    if (content.includes('/*') && content.includes('/index.html')) {
                        log('âœ… é‡å®šå‘é…ç½®æ­£ç¡®', 'success');
                    } else {
                        log('âŒ é‡å®šå‘é…ç½®å¯èƒ½æœ‰é—®é¢˜', 'error');
                    }
                })
                .catch(error => {
                    log(`âŒ _redirectsæ–‡ä»¶æ£€æŸ¥å¤±è´¥: ${error.message}`, 'error');
                });
        }

        function analyzeNetworkRequests() {
            log('ğŸŒ åˆ†æç½‘ç»œè¯·æ±‚...');
            
            const networkElement = document.getElementById('networkAnalysis');
            networkElement.innerHTML = '<p>æ­£åœ¨åˆ†æç½‘ç»œè¯·æ±‚...</p>';
            
            // æµ‹è¯•å…³é”®èµ„æº
            const resources = [
                '/',
                '/success',
                '/assets/',
                '/_redirects',
                'https://api.stripe.com',
                'https://api.emailjs.com'
            ];
            
            resources.forEach(resource => {
                const startTime = performance.now();
                
                fetch(resource, { method: 'HEAD', mode: 'no-cors' })
                    .then(() => {
                        const endTime = performance.now();
                        const duration = Math.round(endTime - startTime);
                        
                        networkElement.innerHTML += `
                            <div class="status-success">
                                ${resource}: âœ… å“åº”æ—¶é—´ ${duration}ms
                            </div>
                        `;
                        
                        log(`${resource}: å“åº”æ—¶é—´ ${duration}ms`, 'success');
                    })
                    .catch(error => {
                        networkElement.innerHTML += `
                            <div class="status-error">
                                ${resource}: âŒ è¯·æ±‚å¤±è´¥ - ${error.message}
                            </div>
                        `;
                        
                        log(`${resource}: è¯·æ±‚å¤±è´¥ - ${error.message}`, 'error');
                    });
            });
        }

        function runDiagnosis() {
            log('ğŸ” å¼€å§‹é—®é¢˜è¯Šæ–­...');
            
            const diagnosisElement = document.getElementById('diagnosis');
            let diagnosis = '<strong>ğŸ” ç”Ÿäº§ç¯å¢ƒé—®é¢˜è¯Šæ–­:</strong><br><br>';
            
            // æ£€æŸ¥ç¯å¢ƒ
            const isProduction = window.location.hostname === 'booking.patchtattootherapy.com';
            diagnosis += isProduction ? 'âœ… ç”Ÿäº§ç¯å¢ƒæ£€æµ‹æ­£ç¡®<br>' : 'âŒ ç¯å¢ƒæ£€æµ‹å¼‚å¸¸<br>';
            
            // æ£€æŸ¥åè®®
            const isHttps = window.location.protocol === 'https:';
            diagnosis += isHttps ? 'âœ… HTTPSåè®®<br>' : 'âŒ éHTTPSåè®®<br>';
            
            // æ£€æŸ¥è·¯ç”±æ”¯æŒ
            const hasHistory = 'pushState' in window.history;
            diagnosis += hasHistory ? 'âœ… History APIæ”¯æŒ<br>' : 'âŒ History APIä¸æ”¯æŒ<br>';
            
            // æ£€æŸ¥localStorage
            const hasLocalStorage = typeof(Storage) !== "undefined";
            diagnosis += hasLocalStorage ? 'âœ… localStorageæ”¯æŒ<br>' : 'âŒ localStorageä¸æ”¯æŒ<br>';
            
            diagnosis += '<br><strong>å¯èƒ½çš„é—®é¢˜:</strong><br>';
            diagnosis += '1. Netlifyéƒ¨ç½²é…ç½®é—®é¢˜<br>';
            diagnosis += '2. _redirectsæ–‡ä»¶ç¼ºå¤±æˆ–é”™è¯¯<br>';
            diagnosis += '3. æ„å»ºè¾“å‡ºä¸å®Œæ•´<br>';
            diagnosis += '4. ç¼“å­˜é—®é¢˜<br>';
            diagnosis += '5. CDNç¼“å­˜é—®é¢˜<br>';
            
            diagnosisElement.innerHTML = diagnosis;
        }

        function generateFixSuggestions() {
            log('ğŸ› ï¸ ç”Ÿæˆä¿®å¤å»ºè®®...');
            
            const suggestionsElement = document.getElementById('fixSuggestions');
            let suggestions = '<strong>ğŸ› ï¸ ä¿®å¤å»ºè®®:</strong><br><br>';
            
            suggestions += '<strong>1. æ£€æŸ¥Netlifyéƒ¨ç½²:</strong><br>';
            suggestions += '- ç¡®è®¤_redirectsæ–‡ä»¶å·²æ­£ç¡®éƒ¨ç½²<br>';
            suggestions += '- æ£€æŸ¥Netlifyæ„å»ºæ—¥å¿—<br>';
            suggestions += '- éªŒè¯éƒ¨ç½²çŠ¶æ€<br><br>';
            
            suggestions += '<strong>2. é‡æ–°éƒ¨ç½²:</strong><br>';
            suggestions += '- æäº¤æœ€æ–°ä»£ç åˆ°Gitä»“åº“<br>';
            suggestions += '- è§¦å‘Netlifyé‡æ–°éƒ¨ç½²<br>';
            suggestions += '- ç­‰å¾…éƒ¨ç½²å®Œæˆ<br><br>';
            
            suggestions += '<strong>3. æ¸…é™¤ç¼“å­˜:</strong><br>';
            suggestions += '- æ¸…é™¤æµè§ˆå™¨ç¼“å­˜<br>';
            suggestions += '- æ¸…é™¤CDNç¼“å­˜<br>';
            suggestions += '- ä½¿ç”¨æ— ç—•æ¨¡å¼æµ‹è¯•<br><br>';
            
            suggestions += '<strong>4. éªŒè¯é…ç½®:</strong><br>';
            suggestions += '- æ£€æŸ¥Stripe Payment Linksé…ç½®<br>';
            suggestions += '- éªŒè¯EmailJSé…ç½®<br>';
            suggestions += '- ç¡®è®¤æ‰€æœ‰ç¯å¢ƒå˜é‡<br><br>';
            
            suggestions += '<strong>5. è”ç³»æ”¯æŒ:</strong><br>';
            suggestions += '- å¦‚æœé—®é¢˜æŒç»­ï¼Œè”ç³»Netlifyæ”¯æŒ<br>';
            suggestions += '- æ£€æŸ¥åŸŸåDNSé…ç½®<br>';
            
            suggestionsElement.innerHTML = suggestions;
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡Œ
        window.onload = function() {
            log('ğŸš€ ç”Ÿäº§ç¯å¢ƒè¯Šæ–­å·¥å…·åŠ è½½å®Œæˆ');
            updateProductionInfo();
            runDiagnosis();
            generateFixSuggestions();
        };
    </script>
</body>
</html>
