<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”Ÿäº§ç¯å¢ƒè°ƒè¯• - Patch Tattoo Therapy</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .debug-container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .debug-section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 5px; }
        .debug-button { padding: 12px 24px; margin: 10px 5px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 14px; }
        .debug-button:hover { background: #0056b3; }
        .success-button { background: #28a745; }
        .success-button:hover { background: #1e7e34; }
        .warning-button { background: #ffc107; color: #212529; }
        .warning-button:hover { background: #e0a800; }
        .info-box { background: #d1ecf1; border: 1px solid #bee5eb; padding: 15px; border-radius: 5px; margin: 15px 0; }
        .code-block { background: #f8f9fa; padding: 10px; border-radius: 3px; font-family: monospace; font-size: 12px; margin: 10px 0; }
        .status-success { color: #28a745; font-weight: bold; }
        .status-error { color: #dc3545; font-weight: bold; }
        .status-warning { color: #ffc107; font-weight: bold; }
    </style>
</head>
<body>
    <div class="debug-container">
        <h1>ğŸ”§ ç”Ÿäº§ç¯å¢ƒè°ƒè¯•å·¥å…·</h1>
        
        <div class="info-box">
            <h3>ğŸ“‹ è°ƒè¯•ç›®æ ‡</h3>
            <p>è¯Šæ–­ç”Ÿäº§ç¯å¢ƒä¸­ <code>/success</code> è·¯ç”±æ— æ³•è®¿é—®çš„é—®é¢˜ã€‚</p>
        </div>

        <div class="debug-section">
            <h3>ğŸŒ ç¯å¢ƒä¿¡æ¯</h3>
            <div id="environmentInfo">
                <p>æ­£åœ¨æ£€æµ‹ç¯å¢ƒä¿¡æ¯...</p>
            </div>
        </div>

        <div class="debug-section">
            <h3>ğŸ”— è·¯ç”±æµ‹è¯•</h3>
            <button class="debug-button" onclick="testSuccessRoute()">
                ğŸ¯ æµ‹è¯• /success è·¯ç”±
            </button>
            
            <button class="debug-button" onclick="testHomeRoute()">
                ğŸ  æµ‹è¯•é¦–é¡µè·¯ç”±
            </button>
            
            <button class="debug-button" onclick="testDirectAccess()">
                ğŸ”— ç›´æ¥è®¿é—® /success
            </button>
            
            <button class="debug-button warning-button" onclick="checkLocalStorage()">
                ğŸ’¾ æ£€æŸ¥localStorage
            </button>
        </div>

        <div class="debug-section">
            <h3>ğŸ“Š æµ‹è¯•ç»“æœ</h3>
            <div id="testResults">
                <p>æµ‹è¯•ç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º...</p>
            </div>
        </div>

        <div class="debug-section">
            <h3>ğŸ” ç½‘ç»œè¯·æ±‚</h3>
            <button class="debug-button" onclick="testNetworkRequests()">
                ğŸŒ æµ‹è¯•ç½‘ç»œè¯·æ±‚
            </button>
            <div id="networkResults">
                <p>ç½‘ç»œè¯·æ±‚ç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º...</p>
            </div>
        </div>

        <div class="debug-section">
            <h3>ğŸ“‹ é—®é¢˜è¯Šæ–­</h3>
            <div id="diagnosis">
                <p>é—®é¢˜è¯Šæ–­ç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º...</p>
            </div>
        </div>
    </div>

    <script>
        function log(message, type = 'info') {
            const resultsElement = document.getElementById('testResults');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${type.toUpperCase()}: ${message}`;
            resultsElement.innerHTML += logEntry + '<br>';
            console.log(logEntry);
        }

        function updateEnvironmentInfo() {
            const envElement = document.getElementById('environmentInfo');
            const info = {
                hostname: window.location.hostname,
                protocol: window.location.protocol,
                port: window.location.port,
                pathname: window.location.pathname,
                href: window.location.href,
                userAgent: navigator.userAgent,
                timestamp: new Date().toISOString()
            };
            
            envElement.innerHTML = `
                <div class="code-block">
                    <strong>ç¯å¢ƒä¿¡æ¯:</strong><br>
                    Hostname: ${info.hostname}<br>
                    Protocol: ${info.protocol}<br>
                    Port: ${info.port || 'default'}<br>
                    Pathname: ${info.pathname}<br>
                    Full URL: ${info.href}<br>
                    User Agent: ${info.userAgent.substring(0, 100)}...<br>
                    Timestamp: ${info.timestamp}
                </div>
            `;
        }

        function testSuccessRoute() {
            log('ğŸ§ª å¼€å§‹æµ‹è¯• /success è·¯ç”±...');
            
            // æµ‹è¯•fetchè¯·æ±‚
            fetch('/success')
                .then(response => {
                    log(`ğŸ“¡ å“åº”çŠ¶æ€: ${response.status} ${response.statusText}`, response.ok ? 'success' : 'error');
                    log(`ğŸ“¡ å“åº”ç±»å‹: ${response.type}`);
                    log(`ğŸ“¡ å“åº”URL: ${response.url}`);
                    return response.text();
                })
                .then(text => {
                    log(`ğŸ“„ å“åº”å†…å®¹é•¿åº¦: ${text.length} å­—ç¬¦`);
                    if (text.includes('SuccessPage') || text.includes('Booking Successful')) {
                        log('âœ… æ‰¾åˆ°Successé¡µé¢å†…å®¹', 'success');
                    } else if (text.includes('index.html')) {
                        log('âš ï¸ è¿”å›äº†index.htmlï¼Œå¯èƒ½æ˜¯SPAè·¯ç”±', 'warning');
                    } else {
                        log('âŒ æœªæ‰¾åˆ°é¢„æœŸçš„Successé¡µé¢å†…å®¹', 'error');
                    }
                })
                .catch(error => {
                    log(`âŒ è¯·æ±‚å¤±è´¥: ${error.message}`, 'error');
                });
        }

        function testHomeRoute() {
            log('ğŸ  æµ‹è¯•é¦–é¡µè·¯ç”±...');
            
            fetch('/')
                .then(response => {
                    log(`ğŸ“¡ é¦–é¡µå“åº”çŠ¶æ€: ${response.status} ${response.statusText}`, response.ok ? 'success' : 'error');
                    return response.text();
                })
                .then(text => {
                    log(`ğŸ“„ é¦–é¡µå†…å®¹é•¿åº¦: ${text.length} å­—ç¬¦`);
                    if (text.includes('React') || text.includes('app')) {
                        log('âœ… é¦–é¡µæ­£å¸¸åŠ è½½', 'success');
                    } else {
                        log('âŒ é¦–é¡µå†…å®¹å¼‚å¸¸', 'error');
                    }
                })
                .catch(error => {
                    log(`âŒ é¦–é¡µè¯·æ±‚å¤±è´¥: ${error.message}`, 'error');
                });
        }

        function testDirectAccess() {
            log('ğŸ”— å°è¯•ç›´æ¥è®¿é—® /success...');
            
            // ä¿å­˜å½“å‰URL
            const currentUrl = window.location.href;
            
            // å°è¯•è·³è½¬åˆ°successé¡µé¢
            window.location.href = '/success';
            
            // 5ç§’åæ£€æŸ¥æ˜¯å¦è¿˜åœ¨å½“å‰é¡µé¢
            setTimeout(() => {
                if (window.location.href === currentUrl) {
                    log('âŒ è·¯ç”±è·³è½¬å¤±è´¥ï¼Œä»åœ¨å½“å‰é¡µé¢', 'error');
                } else {
                    log('âœ… è·¯ç”±è·³è½¬æˆåŠŸ', 'success');
                }
            }, 5000);
        }

        function checkLocalStorage() {
            log('ğŸ’¾ æ£€æŸ¥localStorageæ•°æ®...');
            
            const savedData = localStorage.getItem('patchTattooBooking');
            if (savedData) {
                try {
                    const bookingData = JSON.parse(savedData);
                    log('âœ… æ‰¾åˆ°localStorageæ•°æ®', 'success');
                    log(`- å®¢æˆ·: ${bookingData.formData?.name || 'N/A'}`);
                    log(`- è‰ºæœ¯å®¶: ${bookingData.selectedArtist?.displayName || 'N/A'}`);
                    log(`- æ—¶é—´æˆ³: ${bookingData.timestamp || 'N/A'}`);
                } catch (error) {
                    log(`âŒ è§£ælocalStorageæ•°æ®å¤±è´¥: ${error.message}`, 'error');
                }
            } else {
                log('âš ï¸ æ²¡æœ‰æ‰¾åˆ°localStorageæ•°æ®', 'warning');
            }
        }

        function testNetworkRequests() {
            log('ğŸŒ æµ‹è¯•ç½‘ç»œè¯·æ±‚...');
            
            const networkElement = document.getElementById('networkResults');
            networkElement.innerHTML = '<p>æ­£åœ¨æµ‹è¯•ç½‘ç»œè¯·æ±‚...</p>';
            
            // æµ‹è¯•å¤šä¸ªè·¯å¾„
            const testPaths = ['/', '/success', '/booking-success', '/nonexistent'];
            
            testPaths.forEach(path => {
                fetch(path)
                    .then(response => {
                        const status = response.status;
                        const statusText = response.statusText;
                        const isSuccess = response.ok;
                        
                        networkElement.innerHTML += `
                            <div class="${isSuccess ? 'status-success' : 'status-error'}">
                                ${path}: ${status} ${statusText}
                            </div>
                        `;
                        
                        log(`${path}: ${status} ${statusText}`, isSuccess ? 'success' : 'error');
                    })
                    .catch(error => {
                        networkElement.innerHTML += `
                            <div class="status-error">
                                ${path}: è¯·æ±‚å¤±è´¥ - ${error.message}
                            </div>
                        `;
                        log(`${path}: è¯·æ±‚å¤±è´¥ - ${error.message}`, 'error');
                    });
            });
        }

        function runDiagnosis() {
            log('ğŸ” å¼€å§‹é—®é¢˜è¯Šæ–­...');
            
            const diagnosisElement = document.getElementById('diagnosis');
            let diagnosis = '<strong>ğŸ” é—®é¢˜è¯Šæ–­ç»“æœ:</strong><br><br>';
            
            // æ£€æŸ¥ç¯å¢ƒ
            const isProduction = window.location.hostname === 'booking.patchtattootherapy.com';
            diagnosis += isProduction ? 'âœ… ç”Ÿäº§ç¯å¢ƒæ£€æµ‹æ­£ç¡®<br>' : 'âŒ ç¯å¢ƒæ£€æµ‹å¼‚å¸¸<br>';
            
            // æ£€æŸ¥åè®®
            const isHttps = window.location.protocol === 'https:';
            diagnosis += isHttps ? 'âœ… HTTPSåè®®<br>' : 'âŒ éHTTPSåè®®<br>';
            
            // æ£€æŸ¥localStorage
            const hasLocalStorage = typeof(Storage) !== "undefined";
            diagnosis += hasLocalStorage ? 'âœ… localStorageæ”¯æŒ<br>' : 'âŒ localStorageä¸æ”¯æŒ<br>';
            
            // æ£€æŸ¥è·¯ç”±æ”¯æŒ
            const hasHistory = 'pushState' in window.history;
            diagnosis += hasHistory ? 'âœ… History APIæ”¯æŒ<br>' : 'âŒ History APIä¸æ”¯æŒ<br>';
            
            diagnosis += '<br><strong>å¯èƒ½çš„é—®é¢˜:</strong><br>';
            diagnosis += '1. Netlifyé‡å®šå‘é…ç½®é—®é¢˜<br>';
            diagnosis += '2. React Routeré…ç½®é—®é¢˜<br>';
            diagnosis += '3. æ„å»ºè¾“å‡ºé—®é¢˜<br>';
            diagnosis += '4. ç¼“å­˜é—®é¢˜<br>';
            
            diagnosis += '<br><strong>å»ºè®®è§£å†³æ–¹æ¡ˆ:</strong><br>';
            diagnosis += '1. æ£€æŸ¥Netlifyçš„_redirectsæ–‡ä»¶<br>';
            diagnosis += '2. é‡æ–°éƒ¨ç½²åº”ç”¨<br>';
            diagnosis += '3. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜<br>';
            diagnosis += '4. æ£€æŸ¥æ„å»ºæ—¥å¿—<br>';
            
            diagnosisElement.innerHTML = diagnosis;
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡Œ
        window.onload = function() {
            log('ğŸš€ ç”Ÿäº§ç¯å¢ƒè°ƒè¯•å·¥å…·åŠ è½½å®Œæˆ');
            updateEnvironmentInfo();
            runDiagnosis();
        };
    </script>
</body>
</html>
